#!/usr/bin/env zsh

## Shell script to dump macrostrat-lite from gunnison into a docker db.
### this is a trash and restart kind of thing. 

#create some varibles 
dbname=burwell
localdb=column_data

docker-compose exec db psql -c "DROP DATABASE $localdb WITH (FORCE);"
docker-compose exec db createdb -Upostgres $localdb


echo "Dumping Macrostrat database from Gunnison localForward"
docker-compose exec db psql -Upostgres $localdb -c "CREATE EXTENSION postgis;"
pg_dump -Fc -p 54381 -h localhost -U postgres -W \
  --schema=macrostrat \
  --exclude-table-data=macrostrat.strat_name_footprints \
  --exclude-table-data=macrostrat.measures \
  --exclude-table-data=macrostrat.measuremeta \
  --exclude-table-data=macrostrat.lookup_unit_attrs_api \
  --exclude-table-data=macrostrat.pbdb_collections \
  $dbname \
| docker-compose exec -T db pg_restore -v -Upostgres -d $localdb

