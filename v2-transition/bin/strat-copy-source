#!/usr/bin/env bash

source="$1"

strat copy-data --table sources.$1 --table sources.$1_lines --table sources.$1_polygons --table sources.$1_points
strat copy-data --table maps.sources --schema-only

echo "Copying data from maps.sources table for source $source"
psql -p 5432 -h localhost -U postgres burwell -c "COPY (SELECT * FROM maps.sources WHERE primary_table='$1') TO STDOUT WITH CSV HEADER" \
| strat compose exec -T postgres psql -Upostgres map_ingestion -c "COPY maps.sources FROM STDIN WITH CSV HEADER"