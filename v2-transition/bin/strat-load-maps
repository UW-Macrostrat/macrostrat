ssh -Cfo ExitOnForwardFailure=yes -N -L 5439:localhost:5432 steno
PID=$(pgrep -f 'N -L 5439:')
[ "$PID" ] || exit 1

dbname=burwell

strat compose exec postgres psql -Upostgres -c "DROP SCHEMA carto_new CASCADE;"

echo "Dumping Macrostrat map data from steno"
pg_dump -Fc -p 5439 -h localhost -U postgres \
  --schema=carto_new \
  --exclude-table=carto_new.hex_index \
  --exclude-table=carto_new.pbdb_hex_index \
  $dbname \
| pv \
| strat compose exec -T postgres pg_restore -v -Upostgres -d $dbname

kill $PID